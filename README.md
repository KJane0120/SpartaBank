# **SpartaBank**

## 프로젝트 설명

내일배움캠프 Unity7기 게임개발 심화 개인과제, 

ATM 시스템 구현하기입니다. 

 
 
## 기간
2025.03.20 ~ 2025.03.23



## 기능

1. 회원가입 / 로그인

   회원가입을 하고, 가입한 계정의 ID와 PW를 입력해 로그인할 수 있습니다.

   회원가입 시, PW와 PWConfirm이 다르면 에러창이 뜹니다. 

   초기값은 현금 10만원, 통장잔고 5만원으로 주어집니다. 

3. AIM기능 - 입금
   
   자유롭게 통장으로 입금할 수 있습니다. (10000, 30000, 50000, 직접 입력)

   입금 시 현금이 감소하고, 통장 잔고가 증가하는 것을 UI로 확인할 수 있습니다. 

3. ATM기능 - 출금

   자유롭게 통장에서 출금할 수 있습니다. (10000, 30000, 50000, 직접 입력)

   출금 시 현금이 증가하고, 통장 잔고가 감소하는 것을 UI로 확인할 수 있습니다. 

4. ATM기능 - 송금

   자유롭게 본인의 통장에서 타인의 통장으로 송금할 수 있습니다.

   송금 대상이 유효하지 않거나 송금 대상 및 금액 입력란에 빈칸이 있으면 에러창이 뜹니다.

   송금 시 본인 통장 잔고는 감소하고, 송금 대상의 통장 잔고는 증가합니다. 

5. 유저데이터 저장

   PlayerPrefabs를 통해 ID를 기준으로 PW, Name, Cash, Balance를 저장합니다. 

6. 데이터와 UI 실시간 연동

   Refresh() 함수를 통해 감소 및 증가하는 현금과 통장 잔고를 실시간으로 반영합니다.

## 트러블 슈팅
1. PlayerPrefabs를 통한 유저 데이터 저장

   기존에는 PlayerPrefabs로 간단한 게임에서의 BestScore 저장용도로밖에 써보지 않았는데,

   한 가지 데이터가 아닌 아이디, 비밀번호, 이름, 현금, 통장 잔고라는 여러 데이터를 묶어서 저장한다는 개념이 생소해서 많이 헤맸던 것 같습니다.

2. 로그인을 하면 항상 초기값인 현금 10만원, 통장 잔고 5만원으로 돌아가는 문제

   계정을 생성하고, 로그인을 한 후 입금/출금 등의 활동을 여러번 반복한 뒤 재로그인을 할 시 초기값으로 돌아가는 현상이 있었습니다.

   GameManager에서 직렬화된 UserData를 확인할 수 있는데, 게임 실행 도중 확인해보니 로그인까지는 괜찮지만, 입출금의 활동을 할 시 ID의 데이터가 비는 것을 확인했습니다.

   ID를 기준으로 유저데이터를 저장하다보니, 저장할 때는 ID가 저장경로 자체에 들어가 따로 저장할 필요가 없었지만,

   실수로 로드할 때에도 ID를 따로 로드해야할 필요성을 잊고 GameManager.Instance.data.ID = ID; 라는 코드를 누락했습니다.

   누락 결과 "ID/PW" 같은 저장경로가 아닌 " /PW" 같은 형식으로 데이터들이 저장되고 있던 것이었습니다.

3. 송금 시 이상하게 송금이 되는 문제

    임의로 계정 두개를 생성하고, 송금 결과를 확인할 수 있도록 송금 직전 송금대상의 통장 잔고와, 송금 직후 송금대상의 통장 잔고를 Debug.Log로 확인했습니다.

   내 통장 잔고는 입력한 금액만큼 UI가 업데이트 되지만, 디버그 로그는 5만원을 보냈는데 5천원이 증가한다든지, 뜬금없는 수치가 나와 코드를 분석했습니다.

   분석 결과 PlayerPrefabs.SetInt로 송금대상의 경로까지는 정상적이었지만, 더해주는 과정에서 송금대상의 통장 잔고가 아닌 내 통장 잔고에서 송금금액을 더해주고 있던 사실을 확인했습니다.

   PlayerPrefabs에 미숙하다보니, Key만 잘 지정되면 값도 알아서 Key에 맞는 값이 나올 거라고 생각했던 것 같습니다.

   이를 해결하기 위해 PlayerPrefs.SetInt(id + GameManager.Balance, data.balance + balance); 라는 코드에서, 문제가 되는 data.balance를 int savedMoney = PlayerPrefs.GetInt(id + GameManager.Balance); 라고 PlayerPrefabs에서 값을 가져온 savedMoney 변수로 변경했습니다. 
    
   

   

   

   

   

